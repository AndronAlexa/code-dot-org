- facebook ||= nil
- twitter ||= nil
- download_filename ||= nil
- download_path ||= nil

.modal.fade{id: "showVideo_#{id}"}
  .modal-dialog.modal-lg
    .modal-content
      .modal-header{style: "border-bottom-width: 0px; padding-top: 0px; padding-bottom: 4px; height:48px"}
        %button.close{:type=>"button", :"data-dismiss"=>"modal", style: "height: 48px"}
          %span{:"aria-hidden"=>"true", style: "font-size:48px"} &times;
          %span{:class=>"sr-only"} Close
        %div{style: "clear:both"}
      .modal-body{style: "padding-top: 0px"}
        =view :index_video_reveal, video_code: video_code, facebook: facebook, twitter: twitter, download_filename: download_filename, download_path: download_path

:css
  .modal{
    text-align: center;
  }

:javascript

  window["showVideo_#{id}"] = function()
  {
    $("#showVideo_#{id}").modal('show');
    $("#showVideo_#{id}").on('shown.bs.modal', function () {
      var focusableEls = $(this).find('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select');
      var firstFocusableEl = focusableEls.first()[0];
      var lastFocusableEl = focusableEls.last()[0];
      var KEYCODE_TAB = 9;

      firstFocusableEl.focus();

      $(this).on('keydown', function(e) {
        var isTabPressed = (e.key === 'Tab' || e.keyCode === KEYCODE_TAB);

        if (!isTabPressed) { 
          return; 
        }

        if (e.shiftKey) {
          if (document.activeElement === firstFocusableEl) {
            lastFocusableEl.focus();
            e.preventDefault();
          }
        } else {
          if (document.activeElement === lastFocusableEl) {
            firstFocusableEl.focus();
            e.preventDefault();
          }
        }
      });
    });
    setupPopupWindows();
    window["playVideo_#{id}"](true);

    // send video start action to Google Analytics. Use action field to indicate whether this was from YouTube or Code.org CloudFront
    var fallbackVideo = $("#showVideo_#{id} video");
    var eventAction = (fallbackVideo.length > 0 ? 'startVideoFallback' : 'startVideoYouTube');
    ga('send', 'event', 'showvideo', eventAction, '#{id}');
  };

  $(document).ready(function() {
    $("#showVideo_#{id}").on('hidden.bs.modal', function ()
    {
      // Pause the video.
      window["playVideo_#{id}"](false);
    });
  });

  window["playVideo_#{id}"] = function(play)
  {
    var fallbackVideo = $("#showVideo_#{id} video");

    var youtubeIframeContent = null;
    var videoDiv = $("#showVideo_#{id} .videodiv");
    if (videoDiv.length > 0)
    {
      var iframe = videoDiv[0].getElementsByTagName("iframe");
      if (iframe.length > 0)
      {
        youtubeIframeContent = iframe[0].contentWindow;
      }
    }

    if (fallbackVideo.length > 0)
    {
      videojs(fallbackVideo[0], {}, function() {
        play ? this.play() : this.pause();
      });
    }
    else if (youtubeIframeContent)
    {
      func = play ? 'playVideo' : 'pauseVideo';
      youtubeIframeContent.postMessage('{"event":"command","func":"' + func + '","args":""}', '*');
    }
  }
